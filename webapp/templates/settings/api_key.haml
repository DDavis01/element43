- extends "base.haml"
- load custom_filters
- load humanize
- block title
  = block.super
  {{user.username}} - Settings
- block content
  %h1
    {{user.username}}
  .row-fluid
    .span3
      %ul.nav.nav-tabs.nav-stacked
        %li
          %a{'href':'{% url settings %}'}
            Modify Profile
        %li
          %a{'href':'{% url manage_characters %}'}
            Manage Characters  
        %li.active
          %a{'href':'{% url manage_api_keys %}'}
            Manage API Keys
    .span9
      %h3
        Your API Keys
      %table.table.table-striped
        %thead
          %tr
            %td
              Characters
            %td
              ID
            %td
            %td
        %tbody
          - for key in keys
            %tr
              %td
                - for char in key.character_set.all
                  - if forloop.last
                    {{char.name}}
                  - else
                    {{char.name}},
              %td
                = key.keyid
              %td.text-right
                %a{'href':'{% url add_characters api_id=key.keyid api_verification_code=key.vcode %}'}
                  .btn.btn-primary
                    Add Chars
              %td.text-right
                %a{'href':'{% url remove_api_key apikey_id=key.keyid %}'}
                  .btn.btn-danger
                    Remove
      %hr
      %h3
        Add API Key
      %form.form-horizontal.well{'action':'{% url manage_api_keys %}', 'method':'post'}
        %fieldset
          - csrf_token
          %legend
            API Key
          %div{'class':'control-group{{form.api_id|css_error}}'}
            %label.control-label{'for':'api_id'} ID
            .controls
              = form.api_id
              - if form.api_id.errors
                %span.help-inline
                  - for error in form.api_id.errors
                    = error|escape
          %div{'class':'control-group{{form.api_verification_code|css_error}}'}
            %label.control-label{'for':'api_verification_code'} Verification Code
            .controls
              = form.api_verification_code
              - if form.api_verification_code.errors
                %span.help-inline
                  - for error in form.api_verification_code.errors
                    = error|escape
        %hr
        .control-group
          .controls
            %button.btn.btn-success{'type':'submit'}
              %i.icon-white.icon-check
              Add API Key
      %hr
      %h3
        How to
      %p
        To generate a predefined API key for Element43 visit
        %code
          %a{'href':'https://support.eveonline.com/api/Key/CreatePredefined/23531659', 'target':'_blank'} support.eveonline.com
      %p
        You can also use an already existing key with sufficient permissions. At a minmum Element43 requires "CharacterSheet".  For full functionality Element43 needs the following permissions:
      .well
        %b Account and Market
        %ul
          %li WalletTransactions
          %li WalletJournal
          %li MarketOrders
          %li AccountBalance
        %b Private Information
        %ul
          %li CharacterSheet
          %li CharacterInfo
          %li SkillQueue
          %li SkillInTraining
          %li AssetList
        %b Science and Industry
        %ul
          %li Research
          %li IndustryJobs
      %p
        Your access mask should read 
        %code 23531659
        now.